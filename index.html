<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valida tu permiso</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: white; }
h1 { text-align: center; font-size: 28px; margin-top: 40px; font-weight: 700; }
p.subtitle { text-align: center; color: #555; margin-top: -10px; margin-bottom: 25px; font-size: 16px; }
.container { width: 90%; max-width: 500px; margin: auto; background: #f2f2f2; padding: 25px; border-radius: 15px; }
label { font-weight: bold; font-size: 14px; color: #333; }
input { width: 100%; padding: 15px; margin: 8px 0 18px 0; border-radius: 10px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
#captchaCanvas { display: block; width: 160px; height: 50px; margin-bottom: 10px; }
.buttons { display: flex; }
button { width: 50%; padding: 15px; border: none; font-size: 16px; color: white; cursor: pointer; }
#clearBtn { background: #2ca34f; border-radius: 10px 0 0 10px; }
#validateBtn { background: #2ca34f; border-radius: 0 10px 10px 0; }
</style>
</head>
<body>

<h1>Valida tu permiso</h1>
<p class="subtitle">Por favor, captura los datos que se encuentran en tu Permiso de Importación</p>

<div class="container">
<label>FOLIO DE PERMISO:</label>
<input type="text" placeholder="Folio permiso" id="folio">

<label>ÚLTIMOS 5 CARACTERES DEL NÚMERO DE SERIE<br>DEL VEHÍCULO O HIN DEL VEHÍCULO:</label>
<input type="text" placeholder="VIN/HIN" maxlength="5" id="vin">

<label>ÚLTIMOS 5 CARACTERES DEL NÚMERO DE<br>DOCUMENTO O DEL RFC:</label>
<input type="text" placeholder="Número de documento o RFC" maxlength="5" id="rfc">

<canvas id="captchaCanvas"></canvas>
<input type="text" placeholder="Captcha" id="captchaInput">

<div class="buttons">
<button id="clearBtn" type="button">LIMPIAR</button>
<button id="validateBtn" type="button">VALIDAR</button>
</div>
</div>

<script>
const vehicles = [
  { folio:"50984679", marca:"TOYOTA", vinFull:"3TMLB5JN1RM011856", modelo:"2024", rfcLast5:"50278" },
  { folio:"50387787", marca:"CHEVROLET", vinFull:"1GCPWBEH6MZ117056", modelo:"2021", rfcLast5:"05943" },
  { folio:"50497849", marca:"HONDA", vinFull:"5J6RW2H59HL056248", modelo:"2017", rfcLast5:"50278" },
  { folio:"50697845", marca:"CHEVROLET", vinFull:"3GCUYEED6MG476841", modelo:"2021", rfcLast5:"05943" }
];

let generatedCaptcha = "";

function generarCaptcha() {
  const canvas = document.getElementById("captchaCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = 160; canvas.height = 50;
  ctx.clearRect(0,0,160,50);
  const chars = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789";
  generatedCaptcha = "";
  for(let i=0;i<6;i++) generatedCaptcha += chars[Math.floor(Math.random()*chars.length)];
  ctx.font="32px Georgia"; ctx.fillStyle="#000";
  for(let i=0;i<generatedCaptcha.length;i++) {
    const a=(Math.random()*0.6)-0.3;
    ctx.save(); ctx.translate(20+i*22,30); ctx.rotate(a);
    ctx.fillText(generatedCaptcha[i],0,0); ctx.restore();
  }
  for(let i=0;i<8;i++){
    ctx.beginPath();
    ctx.moveTo(Math.random()*160,Math.random()*50);
    ctx.lineTo(Math.random()*160,Math.random()*50);
    ctx.stroke();
  }
}

function limpiar() {
  document.getElementById("folio").value="";
  document.getElementById("vin").value="";
  document.getElementById("rfc").value="";
  document.getElementById("captchaInput").value="";
  generarCaptcha();
}

function validar(){
  const folio=document.getElementById("folio").value.trim();
  const vin=document.getElementById("vin").value.trim().toUpperCase();
  const rfc=document.getElementById("rfc").value.trim();
  const c=document.getElementById("captchaInput").value.trim();

  if(!folio||!vin||!rfc||!c){ alert("Por favor llena todos los campos."); return; }
  if(c.toLowerCase()!==generatedCaptcha.toLowerCase()){ alert("Captcha incorrecto."); generarCaptcha(); return; }

  const v=vehicles.find(x=>x.folio===folio);
  if(!v){ alert("El folio no existe."); return; }

  if(v.vinFull.slice(-5).toUpperCase()!==vin){ alert("Los últimos 5 del VIN no coinciden."); return; }
  if(v.rfcLast5!==rfc){ alert("Los últimos 5 del RFC no coinciden."); return; }

  window.location.href=`verificar.html?folio=${v.folio}&marca=${v.marca}&modelo=${v.modelo}&vin=${v.vinFull}`;
}

document.getElementById("clearBtn").onclick=limpiar;
document.getElementById("validateBtn").onclick=validar;
window.onload=generarCaptcha;
</script>

</body>
</html>
