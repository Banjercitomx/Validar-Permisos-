<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Permiso Vigente</title>

<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        background: #eaf7ee;
        margin: 0;
        padding: 0;
    }

    .wrap {
        max-width: 600px;
        margin: 20px auto;
        padding: 15px;
    }

    .card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0px 2px 6px rgba(0,0,0,0.08);
    }

    .circle {
        width: 260px;
        height: 180px;
        background: #2e9b4a;
        border-radius: 50%;
        color: white;
        font-weight: 800;
        font-size: 36px;
        display: flex;
        margin: 0 auto 15px auto;
        justify-content: center;
        align-items: center;
        text-align: center;
        line-height: 42px;
    }

    h2 {
        text-align: center;
        font-size: 22px;
        color: #094e36;
        margin-bottom: 10px;
    }

    .timestamp {
        text-align: center;
        color: #094e36;
        font-size: 13px;
        margin-bottom: 18px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    td {
        padding: 10px;
        border: 1px solid #dcdcdc;
        font-size: 15px;
    }

    .label {
        background: #e6f2ea;
        color: #094e36;
        font-weight: 700;
        width: 45%;
    }

    .value {
        font-weight: 800;
        color: #083e2d;
    }

    .btn {
        display: block;
        width: 100%;
        background: #2e9b4a;
        border: none;
        padding: 12px;
        margin-top: 20px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        font-size: 16px;
    }

</style>
</head>
<body>

<div class="wrap">
    <div class="card">

        <div class="circle">¡Permiso<br>Vigente!</div>

        <h2>Permiso de Importación de Auto Americano</h2>
        <p class="timestamp" id="timestamp"></p>

        <table>
            <tr><td class="label">FOLIO:</td><td class="value" id="folio"></td></tr>
            <tr><td class="label">FECHA DE ALTA:</td><td class="value" id="fechaAlta"></td></tr>
            <tr><td class="label">FECHA MÁXIMA DE RETORNO:</td><td class="value" id="fechaRetorno"></td></tr>
            <tr><td class="label">DIAS DISPONIBLES:</td><td class="value" id="diasDisponibles"></td></tr>
            <tr><td class="label">MARCA:</td><td class="value" id="marca"></td></tr>
            <tr><td class="label">VIN:</td><td class="value" id="vin"></td></tr>
            <tr><td class="label">MODELO:</td><td class="value" id="modelo"></td></tr>
            <tr><td class="label">RFC:</td><td class="value" id="rfc"></td></tr>
        </table>

        <button class="btn" onclick="window.history.back()">CERRAR</button>

    </div>
</div>

<script>
// Read query params
const p = new URLSearchParams(window.location.search);

document.getElementById("folio").textContent = p.get("folio");
document.getElementById("marca").textContent = p.get("marca");
document.getElementById("modelo").textContent = p.get("modelo");
document.getElementById("vin").textContent = "********" + p.get("vinLast5");
document.getElementById("rfc").textContent = p.get("rfcLast5");

// Timestamp
const now = new Date();
document.getElementById("timestamp").textContent =
    "FECHA Y HORA DE CONSULTA: " +
    now.toLocaleString("es-MX", { hour12: false });

// 180-DAY ROLLING CYCLE
const totalDias = 180;

// How many days since Jan 1, 2024 (stable cycle)
const startBase = new Date(2024, 0, 1);
const msDiff = now.getTime() - startBase.getTime();
const daysPassed = Math.floor(msDiff / (1000*60*60*24));

// Rolling counter
let diasDisponibles = totalDias - (daysPassed % totalDias);
document.getElementById("diasDisponibles").textContent = diasDisponibles;

// Fecha Alta = today - (180 - diasDisponibles)
let fechaAlta = new Date(now.getTime() - (totalDias - diasDisponibles) * 24*60*60*1000);
document.getElementById("fechaAlta").textContent =
    fechaAlta.toLocaleDateString("es-MX", {year:"numeric", month:"2-digit", day:"2-digit"});

// Fecha Retorno = fechaAlta + 180 days
let fechaRetorno = new Date(fechaAlta.getTime() + 180 * 24*60*60*1000);
document.getElementById("fechaRetorno").textContent =
    fechaRetorno.toLocaleDateString("es-MX", {year:"numeric", month:"2-digit", day:"2-digit"});
</script>

</body>
</html>
